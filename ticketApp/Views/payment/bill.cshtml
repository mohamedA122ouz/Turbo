@{
    var mm = ViewData["employee"] as ticketApp.Models.DBmodels.Employee;
}
<form method="post" asp-action="ConfirmPayment" id="ConfirmPayment">
    <!-- employee name, tickets list, amount input, submit button here -->
    <div class="w-full max-w-2xl mx-auto p-6 bg-white rounded-2xl shadow space-y-6">
        <h2 class="text-2xl font-bold text-center text-gray-800">Cash Payment</h2>

        <!-- Employee Name -->
        <div class="flex justify-between items-center border-b pb-2">
            <span class="text-gray-700 text-lg font-semibold">Employee:</span>
            <span class="text-gray-900 text-lg font-bold">@mm.Name</span>
        </div>

        <!-- Tickets List with scroll if > 5 -->
        <div class="flow-root max-h-96 overflow-y-auto pr-1"> <!-- Scroll kicks in after ~5 items -->
            <ul role="list" class="divide-y divide-gray-200 dark:divide-gray-700">
                @foreach (var ticket in mm.Tickets)
                {
                    <li class="py-3 sm:py-4">
                        <label class="flex items-center cursor-pointer">
                            <div class="shrink-0">
                                <div
                                    class="w-16 h-16 mb-3 rounded-full bg-gray-200 flex items-center justify-center shadow-lg">
                                    <span class="text-gray-500 text-lg">@ticket.Airline.ToUpper()</span>
                                </div>
                            </div>

                            <div class="flex-1 min-w-0 ms-4">
                                <p class="text-sm font-medium text-gray-900 truncate dark:text-white">@ticket.PNR</p>
                                <p class="text-sm text-gray-500 truncate dark:text-gray-400">
                                    From @ticket.Destination.Substring(0, 3) to @ticket.Destination.Substring(3, 3)
                                </p>
                            </div>

                            <div class="flex items-center gap-3">
                                <input type="checkbox"
                                    class="ticket-checkbox w-5 h-5 text-blue-600 border-gray-300 rounded focus:ring-blue-500"
                                    data-amount="@ticket.SellPrice" value="@ticket.Id" name="tickets" />

                                <span class="text-base font-semibold text-gray-900 dark:text-white">
                                    @ticket.SellPrice EGP
                                </span>
                            </div>
                        </label>
                    </li>
                }
            </ul>
        </div>

        <!-- Calculated Total -->
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Total Amount (calculated)</label>
            <input type="text" id="amount" readonly
                class="w-full px-4 py-2 border rounded-lg bg-gray-100 text-gray-800 font-semibold focus:outline-none" />
        </div>

        <!-- Confirmation Input -->
        <div>
            <label for="confirmationAmount" class="block text-sm font-medium text-gray-700 mb-1">
                Enter Amount to Confirm (typed by accountant)
            </label>
            <input type="number" id="confirmationAmount" name="confirmationAmount" step="0.01"
                placeholder="Type amount to confirm"
                class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none"
                required />
        </div>

        <!-- Submit Button -->
        <button type="submit"
            class="w-full mt-4 px-4 py-2 text-white bg-green-600 hover:bg-green-700 rounded-lg shadow text-lg font-semibold">
            Confirm Cash Payment
        </button>
    </div>

</form>
<!-- 💡 JavaScript to auto-update total -->
<script type="module">
    import ShowToast from "/js/toast.js";
    const checkboxes = document.querySelectorAll('.ticket-checkbox');
    const confirmationAmount = document.getElementById('confirmationAmount');
    const ConfirmPayment = document.getElementById('ConfirmPayment');
    const amountInput = document.getElementById('amount');
    ConfirmPayment.addEventListener("submit",checkData);
    function checkData(e){
        if(parseFloat(confirmationAmount.value) !== parseFloat(amountInput.value)){
            ShowToast("You confirmed wrong amount!!")
            e.preventDefault();
        }
    }
    function updateAmount() {
        let total = 0;
        checkboxes.forEach(cb => {
            if (cb.checked) {
                total += parseFloat(cb.dataset.amount);
            }
        });
        amountInput.value = `${total.toFixed(2)} EGP`;
    }

    checkboxes.forEach(cb => cb.addEventListener('change', updateAmount));
</script>
